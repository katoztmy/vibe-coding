# API 設計

## エンドポイント一覧

### 認証関連

- `POST /auth/signup` - ユーザー登録
- `POST /auth/login` - ログイン
- `POST /auth/logout` - ログアウト
- `GET /auth/me` - 現在のユーザー情報取得

### ムカつき投稿関連

- `POST /posts` - 新規ムカつき投稿作成
- `GET /posts` - 自分の投稿一覧取得
- `GET /posts/{id}` - 投稿詳細取得
- `POST /posts/{id}/reaction` - リアクション登録
- `POST /posts/{id}/convert` - 既存投稿の再変換

### その他

- `GET /stats/me` - 自分の投稿統計情報取得

## エンドポイント詳細

### POST /auth/signup

- **目的**: 新規ユーザー登録
- **利用シナリオ**: アプリ初回利用時
- **認証/認可**: 不要
- **前提条件**: メールアドレスが未登録であること
- **副作用**: 新規ユーザー情報の作成
- **バージョン**: v1
- **セキュリティ**: CSRF 保護必須

#### パラメータ

| 名前     | 種類 | データ型 | 必須 | バリデーション/制約          | デフォルト | 例                 |
| -------- | ---- | -------- | ---- | ---------------------------- | ---------- | ------------------ |
| email    | body | string   | はい | メール形式、必須             | なし       | "user@example.com" |
| password | body | string   | はい | 8 文字以上、英数字混在、必須 | なし       | "Password123"      |

#### リクエスト例

```json
{
  "email": "user@example.com",
  "password": "Password123"
}
```

#### レスポンス例（成功）

```json
{
  "id": "uuid-string",
  "email": "user@example.com",
  "created_at": "2023-12-01T12:00:00Z"
}
```

#### レスポンス例（バリデーションエラー）

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "メールアドレスの形式が正しくありません"
  }
}
```

#### エラーコード一覧

| コード               | 意味                         |
| -------------------- | ---------------------------- |
| VALIDATION_ERROR     | 入力値が不正                 |
| EMAIL_ALREADY_EXISTS | メールアドレスが既に登録済み |
| INTERNAL_ERROR       | サーバー内部エラー           |

### POST /auth/login

- **目的**: ユーザー認証
- **利用シナリオ**: アプリログイン時
- **認証/認可**: 不要
- **前提条件**: ユーザーが登録済みであること
- **副作用**: セッショントークンの発行
- **バージョン**: v1
- **セキュリティ**: CSRF 保護必須

#### パラメータ

| 名前     | 種類 | データ型 | 必須 | バリデーション/制約 | デフォルト | 例                 |
| -------- | ---- | -------- | ---- | ------------------- | ---------- | ------------------ |
| email    | body | string   | はい | メール形式、必須    | なし       | "user@example.com" |
| password | body | string   | はい | 必須                | なし       | "Password123"      |

#### リクエスト例

```json
{
  "email": "user@example.com",
  "password": "Password123"
}
```

#### レスポンス例（成功）

```json
{
  "token": "jwt-token-string",
  "user": {
    "id": "uuid-string",
    "email": "user@example.com"
  }
}
```

#### レスポンス例（認証エラー）

```json
{
  "error": {
    "code": "INVALID_CREDENTIALS",
    "message": "メールアドレスまたはパスワードが正しくありません"
  }
}
```

### POST /posts

- **目的**: 新規ムカつき投稿の作成と AI 変換
- **利用シナリオ**: ユーザーがムカつきを投稿する時
- **認証/認可**: ログイン必須
- **前提条件**: なし
- **副作用**: 投稿データの作成、AI 変換処理
- **バージョン**: v1
- **セキュリティ**: CSRF 保護必須、認証必須

#### パラメータ

| 名前    | 種類 | データ型 | 必須 | バリデーション/制約              | デフォルト | 例                                                           |
| ------- | ---- | -------- | ---- | -------------------------------- | ---------- | ------------------------------------------------------------ |
| content | body | string   | はい | 10-200 文字、必須                | なし       | "電車で隣に座った人が、ずっとスマホで動画を大音量で見ている" |
| style   | body | string   | はい | enum["daiogiri", "senryu"]、必須 | "daiogiri" | "senryu"                                                     |

#### リクエスト例

```json
{
  "content": "電車で隣に座った人が、ずっとスマホで動画を大音量で見ている",
  "style": "senryu"
}
```

#### レスポンス例（成功）

```json
{
  "id": "post-uuid",
  "content": "電車で隣に座った人が、ずっとスマホで動画を大音量で見ている",
  "converted_content": "電車内で 音漏れ垂れ流す 無神経",
  "style": "senryu",
  "created_at": "2023-12-01T15:30:00Z",
  "user_id": "user-uuid",
  "reaction": null
}
```

#### レスポンス例（変換エラー）

```json
{
  "error": {
    "code": "CONVERSION_ERROR",
    "message": "AI変換処理に失敗しました。しばらく経ってからお試しください。"
  }
}
```

### GET /posts

- **目的**: ユーザー自身の投稿履歴を取得
- **利用シナリオ**: 履歴閲覧時
- **認証/認可**: ログイン必須
- **前提条件**: なし
- **副作用**: なし
- **バージョン**: v1
- **セキュリティ**: 認証必須

#### パラメータ

| 名前   | 種類  | データ型 | 必須   | バリデーション/制約 | デフォルト | 例           |
| ------ | ----- | -------- | ------ | ------------------- | ---------- | ------------ |
| limit  | query | number   | いいえ | 1-50 の整数         | 20         | 30           |
| offset | query | number   | いいえ | 0 以上の整数        | 0          | 20           |
| date   | query | string   | いいえ | YYYY-MM-DD 形式     | なし       | "2023-12-01" |

#### リクエスト例

```
GET /posts?limit=10&offset=0&date=2023-12-01
```

#### レスポンス例（成功）

```json
{
  "items": [
    {
      "id": "post-uuid-1",
      "content": "電車で隣に座った人が、ずっとスマホで動画を大音量で見ている",
      "converted_content": "電車内で 音漏れ垂れ流す 無神経",
      "style": "senryu",
      "created_at": "2023-12-01T15:30:00Z",
      "reaction": "positive"
    },
    {
      "id": "post-uuid-2",
      "content": "コンビニのレジで小銭を数えるのに時間かかってる人がいて待たされた",
      "converted_content": "急いでるのに、あなたの小銭タイムショー、素晴らしいね！",
      "style": "daiogiri",
      "created_at": "2023-12-01T10:15:00Z",
      "reaction": "negative"
    }
  ],
  "total": 2,
  "limit": 10,
  "offset": 0
}
```

### POST /posts/{id}/reaction

- **目的**: 投稿に対するリアクション（スッキリ度）を登録
- **利用シナリオ**: 変換結果へのリアクション入力時
- **認証/認可**: ログイン必須、自分の投稿のみ
- **前提条件**: 指定した投稿が存在すること
- **副作用**: リアクションデータの作成/更新
- **バージョン**: v1
- **セキュリティ**: CSRF 保護必須、認証必須

#### パラメータ

| 名前 | 種類 | データ型 | 必須 | バリデーション/制約                | デフォルト | 例            |
| ---- | ---- | -------- | ---- | ---------------------------------- | ---------- | ------------- |
| id   | path | string   | はい | UUID 形式、必須                    | なし       | "post-uuid-1" |
| type | body | string   | はい | enum["positive", "negative"]、必須 | なし       | "positive"    |

#### リクエスト例

```json
{
  "type": "positive"
}
```

#### レスポンス例（成功）

```json
{
  "id": "post-uuid-1",
  "reaction": "positive",
  "updated_at": "2023-12-01T15:35:00Z"
}
```

#### レスポンス例（エラー）

```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "指定された投稿が見つかりません"
  }
}
```

### GET /stats/me

- **目的**: ユーザー自身の投稿統計情報を取得
- **利用シナリオ**: 統計/分析画面表示時
- **認証/認可**: ログイン必須
- **前提条件**: なし
- **副作用**: なし
- **バージョン**: v1
- **セキュリティ**: 認証必須

#### パラメータ

| 名前   | 種類  | データ型 | 必須   | バリデーション/制約          | デフォルト | 例     |
| ------ | ----- | -------- | ------ | ---------------------------- | ---------- | ------ |
| period | query | string   | いいえ | enum["week", "month", "all"] | "month"    | "week" |

#### リクエスト例

```
GET /stats/me?period=week
```

#### レスポンス例（成功）

```json
{
  "total_posts": 15,
  "positive_reactions": 10,
  "negative_reactions": 3,
  "no_reactions": 2,
  "positive_rate": 0.667,
  "by_style": {
    "daiogiri": 8,
    "senryu": 7
  },
  "period": "week",
  "period_start": "2023-11-25T00:00:00Z",
  "period_end": "2023-12-01T23:59:59Z"
}
```
